<!DOCTYPE html>
<html lang="en">
<head>
      <title>webOS Homebrew Project - Develop Native GUI Application save_as: develop/tutorials/native-gui-app.html</title>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <meta name="generator" content="Pelican"/>
    <link href="/theme/styles/main.css?2268683e" type="text/css" rel="stylesheet">


</head>

<body id="index" class="home">
<header>
    <div class="logo">
        <a href="/"><img src="/theme/images/icon80.png" width="40px" height="40px"></a>
    </div>
    <nav id="menu">
        <ul>
            <li><a href="https://repo.webosbrew.org">Applications</a></li>
            <li><a href="/develop">Develop</a></li>
        </ul>
    </nav><!-- /#menu -->
</header>
<div id="content">
    <div class="main">
    <h1>Develop Native GUI Application save_as: develop/tutorials/native-gui-app.html</h1>
    

    <p>Native system apps in webOS Uses Qt, but Qt version varies between system versions.</p>
<p>For maximum compatibility, this tutorial shows how to build GUI application with SDL2.</p>
<p>This project is written in C11, and it can run through webOS 1 to webOS 6 without any issue.</p>
<h2 id="config-cmake-project">Config CMake Project<a class="headerlink" href="#config-cmake-project" title="Permanent link">&para;</a></h2>
<p>Start with project declaration.</p>
<p>```cmake
cmake_minimum_required (VERSION 3.8)</p>
<h1 id="this-is-a-cc-project">This is a C/C++ project<a class="headerlink" href="#this-is-a-cc-project" title="Permanent link">&para;</a></h1>
<p>project ("myapp" VERSION 1.0 LANGUAGES C CXX)</p>
<h1 id="use-pkg-config-to-link-needed-libraries">Use <code>pkg-config</code> to link needed libraries.<a class="headerlink" href="#use-pkg-config-to-link-needed-libraries" title="Permanent link">&para;</a></h1>
<p>find_package(PkgConfig REQUIRED)</p>
<h1 id="use-sdl2-for-window-creation-and-event-handling">Use SDL2 for window creation and event handling.<a class="headerlink" href="#use-sdl2-for-window-creation-and-event-handling" title="Permanent link">&para;</a></h1>
<p>pkg_check_modules(SDL2 REQUIRED sdl2)</p>
<h1 id="add-source-to-this-projects-executable">Add source to this project's executable.<a class="headerlink" href="#add-source-to-this-projects-executable" title="Permanent link">&para;</a></h1>
<p>add_executable (myapp "src/myapp.c")</p>
<h1 id="link-sdl2">Link SDL2<a class="headerlink" href="#link-sdl2" title="Permanent link">&para;</a></h1>
<p>target_include_directories("myapp" SYSTEM PRIVATE ${SDL2_INCLUDE_DIRS})
target_link_libraries("myapp" PRIVATE ${SDL2_LIBRARIES})
```</p>
<h2 id="create-an-empty-app-with-sdl2-and-lvgl">Create an empty app with SDL2 and LVGL<a class="headerlink" href="#create-an-empty-app-with-sdl2-and-lvgl" title="Permanent link">&para;</a></h2>
<p>Add <code>lv_conf.h</code>. <code>#defines</code> below are important to have, for other settings you can set based on your use case.</p>
<p>```c
/<em> Use 32-bit color depth </em>/</p>
<h1 id="define-lv_color_depth-32">define LV_COLOR_DEPTH     32<a class="headerlink" href="#define-lv_color_depth-32" title="Permanent link">&para;</a></h1>
<p>/<em> Use stdlib to allocate/free memory </em>/</p>
<h1 id="define-lv_mem_custom-1">define LV_MEM_CUSTOM      1<a class="headerlink" href="#define-lv_mem_custom-1" title="Permanent link">&para;</a></h1>
<h1 id="define-lv_mem_custom_include-header-for-the-dynamic-memory-function">define LV_MEM_CUSTOM_INCLUDE   <string.h>   /<em>Header for the dynamic memory function</em>/<a class="headerlink" href="#define-lv_mem_custom_include-header-for-the-dynamic-memory-function" title="Permanent link">&para;</a></h1>
<h1 id="define-lv_mem_custom_alloc-malloc">define LV_MEM_CUSTOM_ALLOC     malloc<a class="headerlink" href="#define-lv_mem_custom_alloc-malloc" title="Permanent link">&para;</a></h1>
<h1 id="define-lv_mem_custom_free-free">define LV_MEM_CUSTOM_FREE      free<a class="headerlink" href="#define-lv_mem_custom_free-free" title="Permanent link">&para;</a></h1>
<h1 id="define-lv_mem_custom_realloc-realloc">define LV_MEM_CUSTOM_REALLOC   realloc<a class="headerlink" href="#define-lv_mem_custom_realloc-realloc" title="Permanent link">&para;</a></h1>
<p>/<em> Use the standard <code>memcpy</code> and <code>memset</code> instead of LVGL's own functions. </em>/</p>
<h1 id="define-lv_memcpy_memset_std-1">define LV_MEMCPY_MEMSET_STD    1<a class="headerlink" href="#define-lv_memcpy_memset_std-1" title="Permanent link">&para;</a></h1>
<p>/<em> Let LVGL call SDL_GetTicks automatically so we can skip creating a separate timer thread. </em>/</p>
<h1 id="define-lv_tick_custom-1">define LV_TICK_CUSTOM     1<a class="headerlink" href="#define-lv_tick_custom-1" title="Permanent link">&para;</a></h1>
<h1 id="define-lv_tick_custom_include">define LV_TICK_CUSTOM_INCLUDE  <SDL.h><a class="headerlink" href="#define-lv_tick_custom_include" title="Permanent link">&para;</a></h1>
<h1 id="define-lv_tick_custom_sys_time_expr-sdl_getticks">define LV_TICK_CUSTOM_SYS_TIME_EXPR (SDL_GetTicks())<a class="headerlink" href="#define-lv_tick_custom_sys_time_expr-sdl_getticks" title="Permanent link">&para;</a></h1>
<h1 id="define-lv_draw_complex-1">define LV_DRAW_COMPLEX 1<a class="headerlink" href="#define-lv_draw_complex-1" title="Permanent link">&para;</a></h1>
<h1 id="define-lv_shadow_cache_size-0">define LV_SHADOW_CACHE_SIZE    0<a class="headerlink" href="#define-lv_shadow_cache_size-0" title="Permanent link">&para;</a></h1>
<h1 id="define-lv_img_cache_def_size-0">define LV_IMG_CACHE_DEF_SIZE       0<a class="headerlink" href="#define-lv_img_cache_def_size-0" title="Permanent link">&para;</a></h1>
<p>/<em> Use SDL draw backend </em>/</p>
<h1 id="define-lv_use_gpu_sdl-1">define LV_USE_GPU_SDL    1<a class="headerlink" href="#define-lv_use_gpu_sdl-1" title="Permanent link">&para;</a></h1>
<h1 id="define-lv_gpu_sdl_include_path">define LV_GPU_SDL_INCLUDE_PATH <SDL.h><a class="headerlink" href="#define-lv_gpu_sdl_include_path" title="Permanent link">&para;</a></h1>
<p>```</p>
<p>Edit <code>src/myapp.c</code>.</p>
<p>```c
static void process_events();</p>
<p>static lv_disp_t <em>display_init(SDL_Window </em>window);</p>
<p>static void flush_cb(lv_disp_drv_t <em>disp_drv, const lv_area_t </em>area, lv_color_t *src);</p>
<p>static bool running = true;</p>
<p>int main(int argc, char *argv[]) {
    SDL_Init(SDL_INIT_VIDEO);
    lv_init();</p>
<pre><code>int w = 800, h = 480;
SDL_DisplayMode mode;
SDL_GetDisplayMode(0, 0, &amp;mode);
/* Get display size. Fallback to 1920x1080 if failed. */
if (mode.w &gt; 0 &amp;&amp; mode.h &gt; 0) {
    w = mode.w;
    h = mode.h;
}
/* Caveat: Don't use SDL_WINDOW_FULLSCREEN_DESKTOP on webOS. On older platforms it's not supported. */
SDL_Window *window = SDL_CreateWindow("myapp", SDL_WINDOWPOS_UNDEFINED, SDL_WINDOWPOS_UNDEFINED, w, h,
                                      SDL_WINDOW_FULLSCREEN | SDL_WINDOW_ALLOW_HIGHDPI);
lv_disp_t *disp = display_init(window);
lv_disp_set_default(disp);

lv_obj_t *label = lv_label_create(lv_scr_act());
lv_obj_set_pos(label, LV_DPX(10), LV_DPX(10));
lv_label_set_text(label, "Hello, world!");

while (running) {
    process_events();
    lv_task_handler();
    SDL_Delay(1);
}
SDL_DestroyWindow(window);
SDL_Quit();
return 0;
</code></pre>
<p>}
```</p>
<p>Implement functions declared above</p>
<p>```c</p>
<p>static void process_events() {
    SDL_Event event;
    while (SDL_PollEvent(&amp;event)) {
        switch (event.type) {
            case SDL_QUIT:
                running = false;
                break;
            default:
                break;
        }
    }
}</p>
<p>static lv_disp_t <em>display_init(SDL_Window </em>window) {
    int width, height;
    SDL_GetWindowSize(window, &amp;width, &amp;height);
    SDL_SetHint(SDL_HINT_RENDER_SCALE_QUALITY, "1");
    SDL_Renderer <em>renderer = SDL_CreateRenderer(window, -1, SDL_RENDERER_ACCELERATED);
    lv_disp_draw_buf_t </em>draw_buf = malloc(sizeof(lv_disp_draw_buf_t));
    SDL_Texture <em>texture = lv_draw_sdl_create_screen_texture(renderer, width, height);
    lv_disp_draw_buf_init(draw_buf, texture, NULL, width * height);
    lv_disp_drv_t </em>driver = malloc(sizeof(lv_disp_drv_t));
    lv_disp_drv_init(driver);</p>
<pre><code>lv_draw_sdl_drv_param_t *param = lv_mem_alloc(sizeof(lv_draw_sdl_drv_param_t));
param-&gt;renderer = renderer;
driver-&gt;user_data = param;
driver-&gt;draw_buf = draw_buf;
driver-&gt;flush_cb = flush_cb;
driver-&gt;hor_res = width;
driver-&gt;ver_res = height;
SDL_SetRenderTarget(renderer, texture);
lv_disp_t *disp = lv_disp_drv_register(driver);
return disp;
</code></pre>
<p>}</p>
<p>static void flush_cb(lv_disp_drv_t <em>disp_drv, const lv_area_t </em>area, lv_color_t *src) {
    LV_UNUSED(src);
    if (area-&gt;x2 &lt; 0 || area-&gt;y2 &lt; 0 ||
        area-&gt;x1 &gt; disp_drv-&gt;hor_res - 1 || area-&gt;y1 &gt; disp_drv-&gt;ver_res - 1) {
        lv_disp_flush_ready(disp_drv);
        return;
    }</p>
<pre><code>if (lv_disp_flush_is_last(disp_drv)) {
    lv_draw_sdl_drv_param_t *param = disp_drv-&gt;user_data;
    SDL_Renderer *renderer = param-&gt;renderer;
    SDL_Texture *texture = disp_drv-&gt;draw_buf-&gt;buf1;
    SDL_SetRenderTarget(renderer, NULL);
    SDL_SetRenderDrawColor(renderer, 0, 0, 0, 0);
    SDL_RenderClear(renderer);
    SDL_SetTextureBlendMode(texture, SDL_BLENDMODE_BLEND);
    SDL_RenderCopy(renderer, texture, NULL, NULL);
    SDL_RenderPresent(renderer);
    SDL_SetRenderTarget(renderer, texture);
}
lv_disp_flush_ready(disp_drv);
</code></pre>
<p>}
```</p>
<p>Now if you build the project, you should be able to get a binary. If you build the project with system toolchain, you'll
be able to run it, and see "Hello, world!" on top left corner.</p>
<p>Next, we configure CMake to generate IPK for installing on TV.</p>
<h2 id="create-installation-package">Create Installation Package<a class="headerlink" href="#create-installation-package" title="Permanent link">&para;</a></h2>
<h3 id="create-appinfojson">Create <code>appinfo.json</code><a class="headerlink" href="#create-appinfojson" title="Permanent link">&para;</a></h3>
<p><code>json
{
  "id": "com.mycompany.myapp",
  "type": "native",
  "main": "myapp",
  "icon": "icon.png",
  "title": "Native App",
  "version": "0.0.1"
}</code></p>
<h3 id="config-cpack">Config CPack<a class="headerlink" href="#config-cpack" title="Permanent link">&para;</a></h3>
<p>Append to <code>CMakeLists.txt</code>.</p>
<p>```cmake
install(TARGETS myapp RUNTIME DESTINATION .)
install(FILES appinfo.json icon.png DESTINATION .)</p>
<p>set(CPACK_GENERATOR "External")
set(CPACK_EXTERNAL_PACKAGE_SCRIPT "${CMAKE_SOURCE_DIR}/AresPackage.cmake")
set(CPACK_EXTERNAL_ENABLE_STAGING TRUE)
set(CPACK_MONOLITHIC_INSTALL TRUE)</p>
<p>include(CPack)
```</p>
<p>Create <code>AresPackage.cmake</code></p>
<p><code>cmake
execute_process(COMMAND ares-package "${CPACK_TEMPORARY_DIRECTORY}")</code></p>
<h3 id="input-handling">Input Handling<a class="headerlink" href="#input-handling" title="Permanent link">&para;</a></h3>
<h4 id="magic-remote-mouse">Magic Remote (Mouse)<a class="headerlink" href="#magic-remote-mouse" title="Permanent link">&para;</a></h4>
<h4 id="remote-keys-keyboard">Remote Keys (Keyboard)<a class="headerlink" href="#remote-keys-keyboard" title="Permanent link">&para;</a></h4>
<h4 id="bonus-gamepad">Bonus: Gamepad<a class="headerlink" href="#bonus-gamepad" title="Permanent link">&para;</a></h4>
<h3 id="shipping-with-dependencies">Shipping with Dependencies<a class="headerlink" href="#shipping-with-dependencies" title="Permanent link">&para;</a></h3>
<h2 id="tips">Tips<a class="headerlink" href="#tips" title="Permanent link">&para;</a></h2>
<h3 id="remote-gdb-debugging">Remote GDB Debugging<a class="headerlink" href="#remote-gdb-debugging" title="Permanent link">&para;</a></h3>
<h3 id="cross-platform-program-for-easier-debugging">Cross-Platform Program for Easier Debugging<a class="headerlink" href="#cross-platform-program-for-easier-debugging" title="Permanent link">&para;</a></h3>
<h2 id="compatibility">Compatibility<a class="headerlink" href="#compatibility" title="Permanent link">&para;</a></h2>
<h3 id="sdl-version-support-chart">SDL Version Support Chart<a class="headerlink" href="#sdl-version-support-chart" title="Permanent link">&para;</a></h3>

    </div>
    <div class="side">
<h3>Links</h3>
<ul class="links">
    <li><a href="https://github.com/webosbrew/">Github Organization</a></li>
    <li><a href="https://discord.gg/xWqRVEm">Join us on Discord</a></li>
    <li><a href="https://rootmy.tv/">RootMy.TV</a></li>
    <li><a href="https://openlgtv.github.io/">openlgtv</a></li>
</ul>    </div><!-- /.blogroll -->
</div>
<hr>
<footer id="contentinfo" class="body">
    <div class="copyright">&copy; 2022 webOS Homebrew Project</div>
    <div class="powered-by">Powered by <a href="https://getpelican.com/">Pelican</a></div>
</footer><!-- /#contentinfo --></body>
</html>